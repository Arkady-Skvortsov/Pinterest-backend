http {
  upstream loadbalancer {
    least_conn;
    server 127.0.0.1:3501 weight=6;
    server 127.0.0.1:3502 weight=4;
    server 127.0.0.1:3503;
    server 127.0.0.1:3504;
  };

  server {
    listen 3500;

    location / {
      proxy_pass http://loadbalancer/;
    }
  }
}